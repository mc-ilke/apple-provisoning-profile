<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Provisioning Profiles & Capabilities — A Practical iOS Guide</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
  <meta name="description" content="A concise, practical guide to iOS code signing: certificates, App IDs, provisioning profiles, capabilities, entitlements, CI/CD, and troubleshooting.">
  <style>
    :root { color-scheme: light dark; }
    html, body { height: 100%; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background: #f7fafc; }
    .prose-code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; }
    .fade-in { opacity: 0; transform: translateY(12px); transition: opacity .5s ease, transform .5s ease; }
    .fade-in.show { opacity: 1; transform: translateY(0); }
    .card { transition: transform .2s ease, box-shadow .2s ease; }
    .card:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(2,6,23,.08); }
    .active-link { color: #1d4ed8 !important; font-weight: 700; }
    .kbd { border:1px solid #cbd5e1; border-bottom-width: 3px; padding:.1rem .35rem; border-radius:.25rem; font-size:.85em; background:#fff; }
    .puzzle-piece { transition: all 0.3s ease-in-out; }
    .puzzle-piece:hover { transform: scale(1.03); z-index: 10; box-shadow: 0 20px 30px rgba(0,0,0,0.1); }
    @media (prefers-color-scheme: dark) {
      body { background:#0b1220; color:#e5e7eb; }
      .glass { background: rgba(255,255,255,.06); backdrop-filter: blur(10px); }
      .shadow-soft { box-shadow: 0 10px 25px rgba(0,0,0,.35); }
      .bg-hero { background: radial-gradient(1200px 600px at 10% 0%, rgba(59,130,246,.2), transparent 60%), radial-gradient(800px 500px at 90% 20%, rgba(147,197,253,.15), transparent 55%); }
      .card:hover { box-shadow: 0 10px 25px rgba(0,0,0,.3); }
      .puzzle-piece:hover { box-shadow: 0 20px 30px rgba(0,0,0,0.4); }
    }
  </style>
</head>
<body class="text-slate-800 dark:text-slate-200">
  <!-- Top Nav -->
  <header class="sticky top-0 z-50 bg-white/70 dark:bg-slate-900/60 backdrop-blur-md border-b border-slate-200/60 dark:border-slate-700/50">
    <nav class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3"><span class="font-extrabold tracking-tight">Mooncascade Mobile Team</span><span class="font-extrabold tracking-tight">iOS Signing Guide</span></div>
      <div class="hidden md:flex items-center gap-6 text-sm">
        <a href="#overview" class="hover:text-blue-600">Overview</a>
        <a href="#profiles" class="hover:text-blue-600">Profile Types</a>
        <a href="#manual" class="hover:text-blue-600">Manual Steps</a>
        <a href="#capabilities" class="hover:text-blue-600">Capabilities</a>
        <a href="#ci" class="hover:text-blue-600">Team Workflows</a>
        <a href="#troubleshoot" class="hover:text-blue-600">Troubleshoot</a>
        <a href="#resources" class="hover:text-blue-600">Resources</a>
      </div>
    </nav>
  </header>

  <!-- Hero -->
  <section class="bg-hero">
    <div class="max-w-6xl mx-auto px-4 py-16 md:py-24">
      <div class="glass rounded-3xl shadow-soft p-8 md:p-12 bg-white/70 dark:bg-white/5">
        <h1 class="text-4xl md:text-6xl font-black tracking-tight leading-[1.05]">
          Provisioning Profiles & Capabilities
        </h1>
        <p class="mt-5 text-lg md:text-xl text-slate-600 dark:text-slate-300 max-w-3xl">
          A practical guide to Apple’s code signing system: certificates, App IDs, provisioning profiles, capabilities, entitlements, and team workflows.
        </p>
      </div>
    </div>
  </section>

  <main class="max-w-6xl mx-auto px-4 pb-24">
    <!-- Overview -->
    <section id="overview" class="mt-14 fade-in">
      <h2 class="text-3xl md:text-4xl font-black tracking-tight">Overview: The Core Components of Code Signing</h2>
      <p class="mt-4 text-slate-700 dark:text-slate-300 max-w-3xl">
        To build the "chain of trust" that Apple requires, five key components must be correctly defined and linked. Think of it as assembling a puzzle: each piece answers a critical security question. Only when all pieces fit together can a successful, trusted build be created. Before we explain each component, it's important to understand *why* they are all necessary: Apple needs to verify every aspect of an app's origin and permissions before allowing it to run.
      </p>
      <div class="mt-10 flex flex-col lg:flex-row items-center justify-center gap-2">
        <!-- Left Pieces -->
        <div class="flex flex-col gap-2 w-full lg:w-auto">
          <div class="puzzle-piece p-6 rounded-2xl rounded-tr-none bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 lg:w-64">
            <h3 class="text-xl font-bold">1. Certificate (The "Who")</h3>
            <p class="mt-2 text-slate-700 dark:text-slate-300 text-sm">Proves your identity as a trusted developer. It's a cryptographic file that links your private key (kept secret on your machine) to a public key that Apple can verify.</p>
             <ul class="mt-3 list-disc pl-5 text-xs space-y-2 text-slate-600 dark:text-slate-400">
                <li><strong>Types:</strong> "Apple Development" (for debugging) and "Apple Distribution" (for Ad Hoc, TestFlight, and App Store).</li>
                <li><strong>How to Create:</strong> Manually, you create a Certificate Signing Request (CSR) via Keychain Access on your Mac and upload it to the Apple Developer Portal under <code class="prose-code">Certificates</code>.</li>
             </ul>
          </div>
          <div class="puzzle-piece p-6 rounded-2xl rounded-br-none bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 lg:w-64">
            <h3 class="text-xl font-bold">2. Team ID (The "Whose")</h3>
            <p class="mt-2 text-slate-700 dark:text-slate-300 text-sm">A unique 10-character string that identifies your development team. It links all your assets (apps, certificates, profiles) to your specific Apple Developer account.</p>
            <ul class="mt-3 list-disc pl-5 text-xs space-y-2 text-slate-600 dark:text-slate-400">
              <li><strong>Where to Find:</strong> Log in to the <a href="https://developer.apple.com/account" target="_blank" rel="noopener" class="text-blue-600 hover:underline">Apple Developer Portal</a> and click on "Membership". Your Team ID will be listed there.</li>
            </ul>
          </div>
        </div>
        <!-- Center Piece -->
        <div class="puzzle-piece p-8 rounded-2xl bg-blue-600 text-white shadow-xl order-first lg:order-none w-full lg:w-80">
           <h3 class="text-2xl font-bold">Provisioning Profile</h3>
           <p class="mt-2 text-sm font-medium">The central piece that bundles everything together. This file authorizes your app to be launched, linking the Certificate (Who), App ID (What), Team ID (Whose), and Devices (Where).</p>
           <ul class="mt-3 list-disc pl-5 text-xs space-y-2">
            <li><strong>Where to Find:</strong>
                <ul>
                    <li><strong>Portal:</strong> <code class="prose-code">Certificates > Profiles</code>.</li>
                    <li><strong>Local:</strong> <code class="prose-code">~/Library/MobileDevice/Provisioning Profiles/</code>.</li>
                </ul>
            </li>
          </ul>
        </div>
        <!-- Right Pieces -->
        <div class="flex flex-col gap-2 w-full lg:w-auto">
           <div class="puzzle-piece p-6 rounded-2xl rounded-tl-none bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 lg:w-64">
            <h3 class="text-xl font-bold">3. App ID (The "What")</h3>
            <p class="mt-2 text-slate-700 dark:text-slate-300 text-sm">A unique identifier that registers your app with Apple (e.g., <code class="prose-code">com.company.appname</code>). It also serves as a record of the capabilities your app is allowed to use.</p>
            <ul class="mt-3 list-disc pl-5 text-xs space-y-2 text-slate-600 dark:text-slate-400">
            <li><strong>Where to Find:</strong> In Xcode under "Signing & Capabilities" as the "Bundle Identifier", or on the Developer Portal under <code class="prose-code">Identifiers</code>.</li>
          </ul>
          </div>
          <div class="puzzle-piece p-6 rounded-2xl rounded-bl-none bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 lg:w-64">
            <h3 class="text-xl font-bold">4. Capabilities (The "What It Can Do")</h3>
            <p class="mt-2 text-slate-700 dark:text-slate-300 text-sm">Permissions you enable for your app to use special Apple services (like Push Notifications or Apple Pay). Enabling a capability adds an "Entitlement" to your app, which must be listed in the profile.</p>
            <ul class="mt-3 list-disc pl-5 text-xs space-y-2 text-slate-600 dark:text-slate-400">
                <li><strong>Where to Enable:</strong> In Xcode under "Signing & Capabilities", or on the Developer Portal by editing your App ID.</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Device Registration -->
    <section id="devices" class="mt-16 fade-in">
      <h2 class="text-3xl md:text-4xl font-black tracking-tight">Device Registration (The "Where")</h2>
      <p class="mt-4 text-slate-700 dark:text-slate-300 max-w-3xl">
        For Development and Ad Hoc profiles, you must register specific devices by their unique device identifier (UDID). Only registered devices can install and run your app.
      </p>

      <div class="mt-8 grid md:grid-cols-2 gap-8">
        <div class="card p-6 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
          <h3 class="text-lg font-bold mb-4">How to Find Device UDID</h3>
          <div class="space-y-3 text-sm">
            <div>
              <strong class="text-blue-600">Method 1: Via Xcode</strong>
              <p class="text-slate-600 dark:text-slate-400 mt-1">Connect device → Window → Devices and Simulators → Select device → Copy "Identifier"</p>
            </div>
            <div>
              <strong class="text-blue-600">Method 2: Via Finder</strong>
              <p class="text-slate-600 dark:text-slate-400 mt-1">Connect device → Open Finder → Select device in sidebar → Click device name to reveal UDID</p>
            </div>
            <div>
              <strong class="text-blue-600">Method 3: Terminal</strong>
              <p class="text-slate-600 dark:text-slate-400 mt-1"><code class="prose-code bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded">system_profiler SPUSBDataType | grep "Serial Number"</code></p>
            </div>
          </div>
        </div>

        <div class="card p-6 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
          <h3 class="text-lg font-bold mb-4">Device Limits</h3>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span>iPhone/iPad/iPod touch:</span>
              <span class="font-semibold">100 devices/year</span>
            </div>
            <div class="flex justify-between">
              <span>Apple Watch:</span>
              <span class="font-semibold">100 devices/year</span>
            </div>
            <div class="flex justify-between">
              <span>Apple TV:</span>
              <span class="font-semibold">100 devices/year</span>
            </div>
            <div class="flex justify-between">
              <span>Mac computers:</span>
              <span class="font-semibold">100 devices/year</span>
            </div>
          </div>
          <p class="mt-4 text-xs text-slate-600 dark:text-slate-400">
            <strong>Note:</strong> Device registrations reset annually on your membership renewal date.
          </p>
        </div>
      </div>
    </section>

    <!-- Profile Types -->
    <section id="profiles" class="mt-16 fade-in">
      <h2 class="text-3xl md:text-4xl font-black tracking-tight">Provisioning Profile Types</h2>
      <div class="mt-6 grid md:grid-cols-3 gap-8">
        <div class="card p-6 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
          <h3 class="text-xl font-bold">Development</h3>
          <p class="mt-2 text-sm text-slate-600 dark:text-slate-400">
            Install on registered devices for local testing and debugging. Links your development certificate to your App ID and a list of your personal devices.
          </p>
        </div>
        <div class="card p-6 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
          <h3 class="text-xl font-bold">Ad&nbsp;Hoc</h3>
          <p class="mt-2 text-sm text-slate-600 dark:text-slate-400">
            Distribute to a limited set of device UDIDs for internal testing (e.g., via Firebase). It uses a distribution certificate and is the standard for QA builds.
          </p>
        </div>
        <div class="card p-6 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
          <h3 class="text-xl font-bold">App Store</h3>
          <p class="mt-2 text-sm text-slate-600 dark:text-slate-400">
            Required for TestFlight and App Store distribution. It doesn't contain a device list, as it's intended for public release after Apple's review.
          </p>
        </div>
      </div>
    </section>

    <!-- Manual Steps -->
    <section id="manual" class="mt-16 fade-in">
        <h2 class="text-3xl md:text-4xl font-black tracking-tight">Manual Provisioning Walkthrough</h2>
        <p class="mt-3 text-slate-700 dark:text-slate-300 max-w-3xl">
          While Xcode can automate much of this, understanding the manual process on the Developer Portal is crucial for troubleshooting.
        </p>

        <div class="mt-8 grid md:grid-cols-2 gap-8">
          <div class="card p-6 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
            <h3 class="text-lg font-bold mb-4">Step-by-Step Process</h3>
            <ol class="list-decimal pl-6 space-y-2 text-sm text-slate-700 dark:text-slate-300">
              <li>Open <em>Certificates, Identifiers & Profiles</em> → <strong>Profiles</strong> → <span class="kbd">+</span></li>
              <li>Select the profile type (e.g., Development, Ad Hoc, App Store) and click <span class="kbd">Continue</span></li>
              <li>Choose the correct <strong>App ID</strong> for your project. This App ID must already have the capabilities you need enabled on it.</li>
              <li>Select a signing <strong>Certificate</strong>. The private key for this certificate must be installed in the Keychain of the machine that will build the app.</li>
              <li>For Development or Ad Hoc profiles, select the registered devices you want to include.</li>
              <li>Name the profile descriptively (e.g., "MyApp AdHoc Profile") and click <strong>Generate</strong>.</li>
              <li>Download the profile and double-click it to install it in Xcode.</li>
            </ol>
          </div>

          <div class="card p-6 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
            <h3 class="text-lg font-bold mb-4">Certificate Creation Process</h3>
            <div class="space-y-3 text-sm">
              <div>
                <strong class="text-blue-600">1. Generate CSR in Keychain Access</strong>
                <p class="text-slate-600 dark:text-slate-400 mt-1">Keychain Access → Certificate Assistant → Request a Certificate From a Certificate Authority</p>
              </div>
              <div>
                <strong class="text-blue-600">2. Upload CSR to Apple</strong>
                <p class="text-slate-600 dark:text-slate-400 mt-1">Developer Portal → Certificates → "+" → Choose type → Upload CSR file</p>
              </div>
              <div>
                <strong class="text-blue-600">3. Download & Install</strong>
                <p class="text-slate-600 dark:text-slate-400 mt-1">Download .cer file → Double-click to install in Keychain Access</p>
              </div>
            </div>
          </div>
        </div>
    </section>

    <!-- Common Capabilities -->
    <section id="capabilities" class="mt-16 fade-in">
      <h2 class="text-3xl md:text-4xl font-black tracking-tight">Common App Capabilities</h2>
      <p class="mt-3 text-slate-700 dark:text-slate-300 max-w-3xl">
        Understanding which capabilities your app needs and how to enable them correctly is essential for smooth development and deployment.
      </p>

      <div class="mt-8 grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div class="card p-5 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
          <h4 class="font-bold text-blue-600">Push Notifications</h4>
          <p class="text-xs mt-2 text-slate-600 dark:text-slate-400">Enables remote notifications from your server to the app.</p>
          <div class="mt-3 text-xs">
            <strong>Entitlement:</strong> <code class="prose-code bg-slate-100 dark:bg-slate-800 px-1 rounded">aps-environment</code>
          </div>
        </div>

        <div class="card p-5 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
          <h4 class="font-bold text-blue-600">App Groups</h4>
          <p class="text-xs mt-2 text-slate-600 dark:text-slate-400">Share data between your main app and extensions (Today widgets, Share extensions, etc.).</p>
          <div class="mt-3 text-xs">
            <strong>Entitlement:</strong> <code class="prose-code bg-slate-100 dark:bg-slate-800 px-1 rounded">com.apple.security.application-groups</code>
          </div>
        </div>

        <div class="card p-5 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
          <h4 class="font-bold text-blue-600">Apple Pay</h4>
          <p class="text-xs mt-2 text-slate-600 dark:text-slate-400">Process payments using Apple Pay within your app.</p>
          <div class="mt-3 text-xs">
            <strong>Entitlement:</strong> <code class="prose-code bg-slate-100 dark:bg-slate-800 px-1 rounded">com.apple.developer.in-app-payments</code>
          </div>
        </div>

        <div class="card p-5 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
          <h4 class="font-bold text-blue-600">Keychain Sharing</h4>
          <p class="text-xs mt-2 text-slate-600 dark:text-slate-400">Share keychain data between multiple apps from the same developer.</p>
          <div class="mt-3 text-xs">
            <strong>Entitlement:</strong> <code class="prose-code bg-slate-100 dark:bg-slate-800 px-1 rounded">keychain-access-groups</code>
          </div>
        </div>

        <div class="card p-5 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
          <h4 class="font-bold text-blue-600">Background App Refresh</h4>
          <p class="text-xs mt-2 text-slate-600 dark:text-slate-400">Keep your app updated with fresh content when it's not actively being used.</p>
          <div class="mt-3 text-xs">
            <strong>Entitlement:</strong> <code class="prose-code bg-slate-100 dark:bg-slate-800 px-1 rounded">com.apple.developer.background-modes</code>
          </div>
        </div>

        <div class="card p-5 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
          <h4 class="font-bold text-blue-600">Associated Domains</h4>
          <p class="text-xs mt-2 text-slate-600 dark:text-slate-400">Enable universal links, handoff, and shared web credentials.</p>
          <div class="mt-3 text-xs">
            <strong>Entitlement:</strong> <code class="prose-code bg-slate-100 dark:bg-slate-800 px-1 rounded">com.apple.developer.associated-domains</code>
          </div>
        </div>
      </div>

      <div class="mt-8 p-6 rounded-2xl bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800">
        <h4 class="font-bold text-yellow-800 dark:text-yellow-200">⚠️ Important Note</h4>
        <p class="mt-2 text-sm text-yellow-700 dark:text-yellow-300">
          When you enable a capability in Xcode, it must also be enabled on the corresponding App ID in the Developer Portal.
          If there's a mismatch, you'll need to regenerate your provisioning profile to include the new entitlements.
        </p>
      </div>
    </section>

    <!-- Team Workflows & CI/CD -->
    <section id="ci" class="mt-16 fade-in">
        <h2 class="text-3xl md:text-4xl font-black tracking-tight">Team Workflows & CI/CD</h2>
        <p class="mt-3 text-slate-700 dark:text-slate-300 max-w-3xl">
          Managing signing for a team requires a different approach than working locally. The goal is to have a single, reliable source of truth for signing assets.
        </p>
        <div class="mt-6 grid md:grid-cols-2 gap-8">
          <div class="card p-6 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
            <h3 class="text-lg font-bold">Local Workflow (Automatic Signing)</h3>
            <p class="mt-2 text-slate-700 dark:text-slate-300">Ideal for solo developers or initial project setup. By checking "Automatically manage signing," you authorize Xcode to act on your behalf.</p>
            <ul class="mt-3 list-disc pl-6 text-sm space-y-1 text-slate-600 dark:text-slate-400">
              <li><strong>Pros:</strong> Simple, no manual configuration needed.</li>
              <li><strong>Cons:</strong> Creates private keys locally that aren't shared, which breaks team builds. Can unexpectedly revoke existing certificates, impacting other developers.</li>
            </ul>
          </div>
          <div class="card p-6 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
            <h3 class="text-lg font-bold">Team Workflow (Shared & Manual Signing)</h3>
            <p class="mt-2 text-slate-700 dark:text-slate-300">The industry standard for teams and CI/CD. This method uses a central, secure repository for signing assets.</p>
            <ul class="mt-3 list-disc pl-6 text-sm space-y-1 text-slate-600 dark:text-slate-400">
              <li><strong>Method:</strong> Use tools like <strong>Fastlane `match`</strong> to create certificates and profiles and store them, encrypted, in a private Git repository.</li>
              <li><strong>Process:</strong> The CI server clones this repository, decrypts the assets, installs them in a temporary keychain, and then builds the app. This ensures every build is signed with the exact same identity.</li>
            </ul>
          </div>
        </div>

        <!-- CI/CD Implementation Examples -->
        <div class="mt-10">
          <h3 class="text-2xl font-bold mb-6">CI/CD Implementation Examples</h3>
          <div class="grid md:grid-cols-2 gap-8">
            <div class="card p-6 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
              <h4 class="text-lg font-semibold text-green-600">Fastlane Match Setup</h4>
              <div class="mt-4 space-y-3 text-sm">
                <div>
                  <strong>1. Initialize Match</strong>
                  <code class="block mt-1 p-2 bg-slate-100 dark:bg-slate-800 rounded text-xs">fastlane match init</code>
                </div>
                <div>
                  <strong>2. Generate Certificates</strong>
                  <code class="block mt-1 p-2 bg-slate-100 dark:bg-slate-800 rounded text-xs">fastlane match development<br>fastlane match adhoc<br>fastlane match appstore</code>
                </div>
                <div>
                  <strong>3. Use in CI</strong>
                  <code class="block mt-1 p-2 bg-slate-100 dark:bg-slate-800 rounded text-xs">fastlane match adhoc --readonly</code>
                </div>
              </div>
            </div>

            <div class="card p-6 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
              <h4 class="text-lg font-semibold text-purple-600">Xcode Cloud</h4>
              <div class="mt-4 space-y-3 text-sm">
                <div>
                  <strong>Automatic Management</strong>
                  <p class="text-slate-600 dark:text-slate-400 mt-1">Xcode Cloud automatically manages certificates and profiles for your builds.</p>
                </div>
                <div>
                  <strong>Requirements</strong>
                  <ul class="mt-2 list-disc pl-5 text-slate-600 dark:text-slate-400 space-y-1">
                    <li>Team Admin or App Manager role</li>
                    <li>Proper bundle identifier configuration</li>
                    <li>Capabilities enabled in project settings</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
    </section>

    <!-- Troubleshooting -->
    <section id="troubleshoot" class="mt-16 fade-in">
      <h2 class="text-3xl md:text-4xl font-black tracking-tight">Common Troubleshooting</h2>
      <div class="mt-6 overflow-x-auto">
        <table class="w-full text-sm border-separate border-spacing-y-2">
          <thead>
            <tr class="text-left">
              <th class="p-3 font-bold">Symptom</th>
              <th class="p-3 font-bold">Likely Cause</th>
              <th class="p-3 font-bold">Fix</th>
            </tr>
          </thead>
          <tbody>
            <tr class="bg-white/70 dark:bg-slate-900">
              <td class="p-3 font-semibold">"Provisioning profile doesn't include entitlement …"</td>
              <td class="p-3">The capability is enabled in Xcode, but not on the App ID in the Developer Portal (or the profile is stale).</td>
              <td class="p-3">Enable the capability on the App ID, regenerate the provisioning profile, and re-download it.</td>
            </tr>
            <tr class="bg-white/70 dark:bg-slate-900">
              <td class="p-3 font-semibold">Build fails on CI but works locally</td>
              <td class="p-3">The CI machine is missing the certificate's private key.</td>
              <td class="p-3">Ensure your CI process (e.g., using Fastlane `match`) correctly installs the certificate and key into the keychain before the build starts.</td>
            </tr>
            <tr class="bg-white/70 dark:bg-slate-900">
              <td class="p-3 font-semibold">App won't install on a test device</td>
              <td class="p-3">The device's UDID is not included in the Ad Hoc or Development profile.</td>
              <td class="p-3">Add the device's UDID on the Developer Portal, add it to the profile, regenerate the profile, and rebuild the app.</td>
            </tr>
            <tr class="bg-white/70 dark:bg-slate-900">
              <td class="p-3 font-semibold">"No signing certificate found"</td>
              <td class="p-3">The certificate has expired, been revoked, or the private key is missing from your keychain.</td>
              <td class="p-3">Check certificate expiration date. If expired, create a new one. If revoked, investigate why and create replacement.</td>
            </tr>
            <tr class="bg-white/70 dark:bg-slate-900">
              <td class="p-3 font-semibold">"Profile doesn't match bundle identifier"</td>
              <td class="p-3">The provisioning profile was created for a different App ID than what's in your project.</td>
              <td class="p-3">Either change your bundle identifier to match the profile, or create a new profile for your current bundle identifier.</td>
            </tr>
            <tr class="bg-white/70 dark:bg-slate-900">
              <td class="p-3 font-semibold">Xcode shows "No profiles for team ID"</td>
              <td class="p-3">Your Apple ID isn't associated with the team, or profiles aren't downloaded.</td>
              <td class="p-3">Check your team membership in Developer Portal. In Xcode, go to Preferences → Accounts → Download Manual Profiles.</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Quick Diagnostic Commands -->
      <div class="mt-10">
        <h3 class="text-2xl font-bold mb-6">Quick Diagnostic Commands</h3>
        <div class="grid md:grid-cols-2 gap-6">
          <div class="card p-6 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
            <h4 class="font-bold text-green-600 mb-3">Check Installed Certificates</h4>
            <code class="block p-3 bg-slate-100 dark:bg-slate-800 rounded text-xs">security find-identity -v -p codesigning</code>
            <p class="mt-2 text-xs text-slate-600 dark:text-slate-400">Lists all code signing certificates in your default keychain</p>
          </div>

          <div class="card p-6 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
            <h4 class="font-bold text-green-600 mb-3">List Provisioning Profiles</h4>
            <code class="block p-3 bg-slate-100 dark:bg-slate-800 rounded text-xs">ls ~/Library/MobileDevice/Provisioning\ Profiles/</code>
            <p class="mt-2 text-xs text-slate-600 dark:text-slate-400">Shows all installed provisioning profiles on your machine</p>
          </div>

          <div class="card p-6 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
            <h4 class="font-bold text-green-600 mb-3">Inspect Profile Details</h4>
            <code class="block p-3 bg-slate-100 dark:bg-slate-800 rounded text-xs">security cms -D -i "profile.mobileprovision"</code>
            <p class="mt-2 text-xs text-slate-600 dark:text-slate-400">View the contents and entitlements of a specific profile</p>
          </div>

          <div class="card p-6 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
            <h4 class="font-bold text-green-600 mb-3">Clean Derived Data</h4>
            <code class="block p-3 bg-slate-100 dark:bg-slate-800 rounded text-xs">rm -rf ~/Library/Developer/Xcode/DerivedData</code>
            <p class="mt-2 text-xs text-slate-600 dark:text-slate-400">Often fixes mysterious build issues related to cached signing data</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Best Practices -->
    <section id="best-practices" class="mt-16 fade-in">
      <h2 class="text-3xl md:text-4xl font-black tracking-tight">Best Practices & Pro Tips</h2>

      <div class="mt-8 grid md:grid-cols-2 gap-8">
        <div class="card p-6 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
          <h3 class="text-lg font-bold text-blue-600 mb-4">🛡️ Security Best Practices</h3>
          <ul class="space-y-2 text-sm text-slate-700 dark:text-slate-300">
            <li class="flex items-start gap-2">
              <span class="text-green-500 mt-1">✓</span>
              <span>Never share certificate private keys directly - use encrypted repositories (Fastlane Match)</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-green-500 mt-1">✓</span>
              <span>Rotate certificates before they expire (1-year validity for distribution certificates)</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-green-500 mt-1">✓</span>
              <span>Use separate Apple IDs for different team roles when possible</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-green-500 mt-1">✓</span>
              <span>Regularly audit and clean up unused profiles and certificates</span>
            </li>
          </ul>
        </div>

        <div class="card p-6 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
          <h3 class="text-lg font-bold text-purple-600 mb-4">⚡ Efficiency Tips</h3>
          <ul class="space-y-2 text-sm text-slate-700 dark:text-slate-300">
            <li class="flex items-start gap-2">
              <span class="text-green-500 mt-1">✓</span>
              <span>Use descriptive naming conventions: "AppName_AdHoc_2024" for profiles</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-green-500 mt-1">✓</span>
              <span>Create wildcard App IDs for rapid prototyping: <code class="prose-code">com.company.*</code></span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-green-500 mt-1">✓</span>
              <span>Set up automatic profile regeneration in Fastlane for capability changes</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-green-500 mt-1">✓</span>
              <span>Use Xcode's "Download Manual Profiles" to sync latest profiles from Portal</span>
            </li>
          </ul>
        </div>
      </div>

      <!-- Common Mistakes -->
      <div class="mt-8 p-6 rounded-2xl bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800">
        <h4 class="font-bold text-red-800 dark:text-red-200 mb-3">🚨 Common Mistakes to Avoid</h4>
        <div class="grid md:grid-cols-2 gap-4 text-sm">
          <ul class="space-y-2 text-red-700 dark:text-red-300">
            <li class="flex items-start gap-2">
              <span class="text-red-500 mt-1">✗</span>
              <span>Using automatic signing on CI/CD systems</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-red-500 mt-1">✗</span>
              <span>Mixing automatic and manual signing across team members</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-red-500 mt-1">✗</span>
              <span>Forgetting to regenerate profiles after adding capabilities</span>
            </li>
          </ul>
          <ul class="space-y-2 text-red-700 dark:text-red-300">
            <li class="flex items-start gap-2">
              <span class="text-red-500 mt-1">✗</span>
              <span>Creating multiple certificates of the same type unnecessarily</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-red-500 mt-1">✗</span>
              <span>Not backing up certificate private keys securely</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-red-500 mt-1">✗</span>
              <span>Hardcoding team IDs or bundle identifiers in build scripts</span>
            </li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Resources -->
    <section id="resources" class="mt-16 fade-in">
      <h2 class="text-3xl md:text-4xl font-black tracking-tight">Resources & Tools</h2>

      <!-- Official Documentation -->
      <div class="mt-8">
        <h3 class="text-2xl font-bold mb-6">Official Apple Documentation</h3>
        <div class="grid md:grid-cols-2 gap-6">
          <a class="card p-5 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 hover:bg-blue-50/50 dark:hover:bg-white/5"
             target="_blank" rel="noopener"
             href="https://developer.apple.com/help/account/provisioning-profiles/provisioning-profile-updates">
            <div class="font-semibold">Provisioning Profile Updates</div>
            <div class="text-sm mt-1 text-slate-600 dark:text-slate-400">General information about how profiles work and recent changes.</div>
          </a>
          <a class="card p-5 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 hover:bg-blue-50/50 dark:hover:bg-white/5"
             target="_blank" rel="noopener"
             href="https://developer.apple.com/help/account/provisioning-profiles/create-a-development-provisioning-profile">
            <div class="font-semibold">Create a Development Profile</div>
            <div class="text-sm mt-1 text-slate-600 dark:text-slate-400">Step-by-step (manual) setup.</div>
          </a>
          <a class="card p-5 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 hover:bg-blue-50/50 dark:hover:bg-white/5"
             target="_blank" rel="noopener"
             href="https://developer.apple.com/help/account/provisioning-profiles/create-an-ad-hoc-provisioning-profile/">
            <div class="font-semibold">Create an Ad Hoc Profile</div>
            <div class="text-sm mt-1 text-slate-600 dark:text-slate-400">Limited device distribution for testers.</div>
          </a>
          <a class="card p-5 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 hover:bg-blue-50/50 dark:hover:bg-white/5"
             target="_blank" rel="noopener"
             href="https://developer.apple.com/help/account/provisioning-profiles/create-an-app-store-provisioning-profile">
            <div class="font-semibold">Create an App Store Profile</div>
            <div class="text-sm mt-1 text-slate-600 dark:text-slate-400">For TestFlight & App Store uploads.</div>
          </a>
          <a class="card p-5 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 hover:bg-blue-50/50 dark:hover:bg-white/5"
             target="_blank" rel="noopener"
             href="https://developer.apple.com/documentation/security/certificate_key_and_trust_services">
            <div class="font-semibold">Certificate, Key, and Trust Services</div>
            <div class="text-sm mt-1 text-slate-600 dark:text-slate-400">Technical documentation on Apple's cryptographic framework.</div>
          </a>
          <a class="card p-5 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 hover:bg-blue-50/50 dark:hover:bg-white/5"
             target="_blank" rel="noopener"
             href="https://developer.apple.com/documentation/bundleresources/entitlements">
            <div class="font-semibold">Entitlements Reference</div>
            <div class="text-sm mt-1 text-slate-600 dark:text-slate-400">Complete list of all available app entitlements.</div>
          </a>
        </div>
      </div>

      <!-- Third-Party Tools -->
      <div class="mt-12">
        <h3 class="text-2xl font-bold mb-6">Essential Third-Party Tools</h3>
        <div class="grid md:grid-cols-2 gap-6">
          <a class="card p-5 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 hover:bg-green-50/50 dark:hover:bg-white/5"
             target="_blank" rel="noopener"
             href="https://docs.fastlane.tools/actions/match/">
            <div class="font-semibold text-green-600">Fastlane Match</div>
            <div class="text-sm mt-1 text-slate-600 dark:text-slate-400">Industry standard for team certificate management. Stores encrypted signing assets in Git.</div>
          </a>
          <a class="card p-5 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 hover:bg-green-50/50 dark:hover:bg-white/5"
             target="_blank" rel="noopener"
             href="https://docs.fastlane.tools/actions/sigh/">
            <div class="font-semibold text-green-600">Fastlane Sigh</div>
            <div class="text-sm mt-1 text-slate-600 dark:text-slate-400">Create and renew provisioning profiles automatically via command line.</div>
          </a>
        </div>
      </div>

      <!-- Quick Reference -->
      <div class="mt-12">
        <h3 class="text-2xl font-bold mb-6">Quick Reference</h3>
        <div class="grid md:grid-cols-2 gap-8">
          <div class="card p-6 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
            <h4 class="font-bold text-blue-600 mb-4">Important File Locations</h4>
            <div class="space-y-2 text-sm">
              <div>
                <strong>Provisioning Profiles:</strong>
                <code class="block mt-1 text-xs bg-slate-100 dark:bg-slate-800 p-2 rounded">~/Library/MobileDevice/Provisioning Profiles/</code>
              </div>
              <div>
                <strong>Keychain (certificates):</strong>
                <code class="block mt-1 text-xs bg-slate-100 dark:bg-slate-800 p-2 rounded">~/Library/Keychains/login.keychain-db</code>
              </div>
              <div>
                <strong>Xcode Derived Data:</strong>
                <code class="block mt-1 text-xs bg-slate-100 dark:bg-slate-800 p-2 rounded">~/Library/Developer/Xcode/DerivedData</code>
              </div>
            </div>
          </div>

          <div class="card p-6 rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800">
            <h4 class="font-bold text-blue-600 mb-4">Certificate Validity Periods</h4>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span>Apple Development:</span>
                <span class="font-semibold">1 year</span>
              </div>
              <div class="flex justify-between">
                <span>Apple Distribution:</span>
                <span class="font-semibold">1 year</span>
              </div>
              <div class="flex justify-between">
                <span>Provisioning Profiles:</span>
                <span class="font-semibold">1 year (max)</span>
              </div>
              <div class="flex justify-between">
                <span>Developer Program:</span>
                <span class="font-semibold">1 year</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="mt-20 pt-10 pb-14 text-center text-sm text-slate-500 dark:text-slate-400">
      <div>Provisioning Profiles & Capabilities — A Practical iOS Guide</div>
      <div class="mt-2">© <span id="year"></span> Mooncascade Mobile Team</div>
    </footer>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const observer = new IntersectionObserver((entries)=>{
            entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('show'); } });
        }, { threshold: .12 });
        document.querySelectorAll('.fade-in').forEach(el=>observer.observe(el));
        
        const links = Array.from(document.querySelectorAll('header nav a[href^="#"]'));
        const sections = links.map(a => document.querySelector(a.getAttribute('href'))).filter(Boolean);
        const navObs = new IntersectionObserver((entries)=>{
            entries.forEach(entry=>{
                const idx = sections.indexOf(entry.target);
                if(idx >= 0){
                    const link = links[idx];
                    if(entry.isIntersecting){
                        links.forEach(l=>l.classList.remove('active-link'));
                        link.classList.add('active-link');
                    }
                }
            });
        }, { rootMargin: "-35% 0% -60% 0%"});
        sections.forEach(s=>navObs.observe(s));
        
        document.getElementById('year').textContent = new Date().getFullYear();
    });
  </script>
</body>
</html>
